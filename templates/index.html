<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Todo Chatbot</title>
    <link
      rel="preconnect"
      href="https://fonts.googleapis.com"
    />
    <link
      rel="preconnect"
      href="https://fonts.gstatic.com"
      crossorigin
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --bg: #f6f2ea;
        --ink: #1e1b18;
        --brand: #1d7f68;
        --brand-dark: #145747;
        --panel: rgba(255, 255, 255, 0.78);
        --line: rgba(31, 29, 26, 0.12);
        --user: #e3f8f2;
        --bot: #fff7e5;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        min-height: 100vh;
        font-family: "Space Grotesk", "Segoe UI", sans-serif;
        color: var(--ink);
        background:
          radial-gradient(circle at 8% 12%, #ffe6ae 0, transparent 30%),
          radial-gradient(circle at 90% 4%, #c9efe4 0, transparent 32%),
          linear-gradient(145deg, #f8f4ed, #f2efe7 45%, #e9f0ea);
        display: grid;
        place-items: center;
        padding: 24px;
      }

      .orb {
        position: fixed;
        border-radius: 999px;
        filter: blur(48px);
        pointer-events: none;
        z-index: 0;
      }

      .orb.one {
        width: 280px;
        height: 280px;
        background: rgba(37, 183, 145, 0.22);
        top: -70px;
        right: 4vw;
      }

      .orb.two {
        width: 240px;
        height: 240px;
        background: rgba(255, 199, 89, 0.25);
        left: 4vw;
        bottom: -90px;
      }

      .shell {
        position: relative;
        z-index: 1;
        width: min(860px, 100%);
        height: min(760px, 88vh);
        border: 1px solid var(--line);
        border-radius: 20px;
        background: var(--panel);
        backdrop-filter: blur(10px);
        display: grid;
        grid-template-rows: auto 1fr auto;
        overflow: hidden;
        box-shadow: 0 24px 58px rgba(35, 28, 18, 0.14);
      }

      .top {
        padding: 20px 22px;
        border-bottom: 1px solid var(--line);
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 16px;
      }

      .title-wrap {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .badge {
        width: 34px;
        height: 34px;
        border-radius: 10px;
        background: linear-gradient(145deg, #24a185, #176352);
        display: grid;
        place-items: center;
        color: white;
        font-weight: 700;
      }

      h1 {
        margin: 0;
        font-size: clamp(1.05rem, 2vw, 1.35rem);
      }

      .hint {
        margin: 0;
        opacity: 0.75;
        font-size: 0.9rem;
      }

      .messages {
        padding: 18px;
        display: flex;
        flex-direction: column;
        gap: 10px;
        overflow-y: auto;
      }

      .msg {
        max-width: 78%;
        padding: 12px 14px;
        border-radius: 14px;
        border: 1px solid var(--line);
        white-space: pre-wrap;
        line-height: 1.35;
        animation: rise 180ms ease;
      }

      .msg.user {
        margin-left: auto;
        background: var(--user);
      }

      .msg.bot {
        margin-right: auto;
        background: var(--bot);
      }

      .composer {
        border-top: 1px solid var(--line);
        padding: 14px;
      }

      .row {
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 10px;
      }

      input {
        width: 100%;
        border: 1px solid var(--line);
        background: #ffffff;
        color: var(--ink);
        border-radius: 12px;
        padding: 12px 14px;
        font: inherit;
      }

      input:focus {
        outline: 2px solid #89c8ba;
        outline-offset: 1px;
      }

      button {
        border: none;
        border-radius: 12px;
        padding: 0 18px;
        font: inherit;
        font-weight: 600;
        color: white;
        background: linear-gradient(145deg, var(--brand), var(--brand-dark));
        cursor: pointer;
      }

      button:hover {
        filter: brightness(1.05);
      }

      @keyframes rise {
        from {
          opacity: 0;
          transform: translateY(6px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @media (max-width: 640px) {
        body {
          padding: 12px;
        }

        .shell {
          height: min(760px, 95vh);
          border-radius: 16px;
        }

        .msg {
          max-width: 88%;
        }
      }
    </style>
  </head>
  <body>
    <div class="orb one"></div>
    <div class="orb two"></div>

    <main class="shell">
      <header class="top">
        <div class="title-wrap">
          <div class="badge">T</div>
          <div>
            <h1>Todo Chatbot</h1>
            <p class="hint">Try: add buy milk, list, done 1</p>
          </div>
        </div>
      </header>

      <section id="messages" class="messages"></section>

      <footer class="composer">
        <form id="chat-form" class="row">
          <input
            id="chat-input"
            placeholder="Type a message..."
            autocomplete="off"
            required
          />
          <button type="submit">Send</button>
        </form>
      </footer>
    </main>

    <script>
      const messagesEl = document.getElementById("messages");
      const formEl = document.getElementById("chat-form");
      const inputEl = document.getElementById("chat-input");

      function addMessage(role, text) {
        const message = document.createElement("div");
        message.className = `msg ${role}`;
        message.textContent = text;
        messagesEl.appendChild(message);
        messagesEl.scrollTop = messagesEl.scrollHeight;
      }

      async function sendMessage(message) {
        const response = await fetch("/api/chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message }),
        });

        const payload = await response.json();
        if (!response.ok) {
          throw new Error(payload.error || "Request failed");
        }
        return payload.reply;
      }

      formEl.addEventListener("submit", async (event) => {
        event.preventDefault();
        const message = inputEl.value.trim();
        if (!message) return;

        inputEl.value = "";
        addMessage("user", message);

        try {
          const reply = await sendMessage(message);
          addMessage("bot", reply);
        } catch (error) {
          addMessage("bot", `Error: ${error.message}`);
        }
      });

      addMessage("bot", "Ready. Use 'help' to see commands.");
    </script>
  </body>
</html>
